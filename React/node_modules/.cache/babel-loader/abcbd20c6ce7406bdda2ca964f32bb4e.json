{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\woojo\\\\source\\\\repos\\\\material-dashboard-react-aspnet\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\woojo\\\\source\\\\repos\\\\material-dashboard-react-aspnet\\\\React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport ClientOAuth2 from \"client-oauth2\";\nimport axios from \"axios\";\nimport { setAuthHeader } from \"utils/axiosHeaders\";\nimport { storeUserError, storeUser, userSignedOut } from \"../actions/authActions\";\nimport store from \"store\";\nvar config = {\n  clientId: \"react.client\",\n  accessTokenUri: \"\".concat(process.env.REACT_APP_AUTH_SERVER_URL, \"/connect/token\"),\n  userInfoUri: \"\".concat(process.env.REACT_APP_AUTH_SERVER_URL, \"/connect/userinfo\"),\n  endsessionUri: \"\".concat(process.env.REACT_APP_AUTH_SERVER_URL, \"/connect/endsession\"),\n  introspectURL: \"\".concat(process.env.REACT_APP_AUTH_SERVER_URL, \"/connect/introspect\"),\n  scopes: []\n};\nvar oauth = new ClientOAuth2(config);\nexport function loadUserFromStorage(_x) {\n  return _loadUserFromStorage.apply(this, arguments);\n}\n\nfunction _loadUserFromStorage() {\n  _loadUserFromStorage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(store) {\n    var user;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return userProfile();\n\n          case 3:\n            user = _context.sent;\n\n            if (user) {\n              _context.next = 6;\n              break;\n            }\n\n            return _context.abrupt(\"return\", store.dispatch(storeUserError()));\n\n          case 6:\n            store.dispatch(storeUser(user.data));\n            _context.next = 13;\n            break;\n\n          case 9:\n            _context.prev = 9;\n            _context.t0 = _context[\"catch\"](0);\n            console.error(\"User not found: \".concat(_context.t0));\n            store.dispatch(storeUserError());\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 9]]);\n  }));\n  return _loadUserFromStorage.apply(this, arguments);\n}\n\nexport var login = function login(params) {\n  return oauth.owner.getToken(params.email, params.password).then(function (result) {\n    localStorage.setItem(\"access_token\", result.accessToken);\n    setAuthHeader(result.accessToken); //get and store user details\n\n    loadUserFromStorage(store);\n    return result;\n  })[\"catch\"](function (error) {\n    localStorage.removeItem(\"access_token\");\n    console.log(error);\n  });\n};\nexport var logoff = function logoff() {\n  userSignedOut();\n};\nexport var userProfile = function userProfile() {\n  var token = localStorage.getItem(\"access_token\");\n\n  if (token) {\n    axios.defaults.headers.common[\"Authorization\"] = token ? \"Bearer \" + token : \"\";\n    return axios.get(config.userInfoUri);\n  } else {\n    return null;\n  }\n};\nexport var validateToken = function validateToken(token) {\n  return axios.post(config.introspectURL, {\n    token: token\n  }).then(function (result) {\n    console.log(result);\n  })[\"catch\"](function (error) {\n    console.error(error);\n  });\n};\nexport default oauth;","map":{"version":3,"sources":["C:/Users/woojo/source/repos/material-dashboard-react-aspnet/React/src/services/oauth.js"],"names":["ClientOAuth2","axios","setAuthHeader","storeUserError","storeUser","userSignedOut","store","config","clientId","accessTokenUri","process","env","REACT_APP_AUTH_SERVER_URL","userInfoUri","endsessionUri","introspectURL","scopes","oauth","loadUserFromStorage","userProfile","user","dispatch","data","console","error","login","params","owner","getToken","email","password","then","result","localStorage","setItem","accessToken","removeItem","log","logoff","token","getItem","defaults","headers","common","get","validateToken","post"],"mappings":"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","sourcesContent":["import ClientOAuth2 from \"client-oauth2\";\r\nimport axios from \"axios\";\r\nimport { setAuthHeader } from \"utils/axiosHeaders\";\r\nimport {\r\n  storeUserError,\r\n  storeUser,\r\n  userSignedOut,\r\n} from \"../actions/authActions\";\r\nimport store from \"store\";\r\n\r\nconst config = {\r\n  clientId: \"react.client\",\r\n  accessTokenUri: `${process.env.REACT_APP_AUTH_SERVER_URL}/connect/token`,\r\n  userInfoUri: `${process.env.REACT_APP_AUTH_SERVER_URL}/connect/userinfo`,\r\n  endsessionUri: `${process.env.REACT_APP_AUTH_SERVER_URL}/connect/endsession`,\r\n  introspectURL: `${process.env.REACT_APP_AUTH_SERVER_URL}/connect/introspect`,\r\n  scopes: [],\r\n};\r\n\r\nconst oauth = new ClientOAuth2(config);\r\n\r\nexport async function loadUserFromStorage(store) {\r\n  try {\r\n    let user = await userProfile();\r\n    if (!user) {\r\n      return store.dispatch(storeUserError());\r\n    }\r\n    store.dispatch(storeUser(user.data));\r\n  } catch (e) {\r\n    console.error(`User not found: ${e}`);\r\n    store.dispatch(storeUserError());\r\n  }\r\n}\r\n\r\nexport const login = (params) => {\r\n  return oauth.owner\r\n    .getToken(params.email, params.password)\r\n    .then((result) => {\r\n      localStorage.setItem(\"access_token\", result.accessToken);\r\n      setAuthHeader(result.accessToken);\r\n\r\n      //get and store user details\r\n      loadUserFromStorage(store);\r\n\r\n      return result;\r\n    })\r\n    .catch((error) => {\r\n      localStorage.removeItem(\"access_token\");\r\n      console.log(error);\r\n    });\r\n};\r\n\r\nexport const logoff = () => {\r\n  userSignedOut();\r\n};\r\n\r\nexport const userProfile = () => {\r\n  var token = localStorage.getItem(\"access_token\");\r\n  if (token) {\r\n    axios.defaults.headers.common[\"Authorization\"] = token\r\n      ? \"Bearer \" + token\r\n      : \"\";\r\n    return axios.get(config.userInfoUri);\r\n  } else {\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const validateToken = (token) => {\r\n  return axios\r\n    .post(config.introspectURL, { token: token })\r\n    .then((result) => {\r\n      console.log(result);\r\n    })\r\n    .catch((error) => {\r\n      console.error(error);\r\n    });\r\n};\r\n\r\nexport default oauth;\r\n"]},"metadata":{},"sourceType":"module"}